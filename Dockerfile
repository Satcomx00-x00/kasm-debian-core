FROM debian
CMD ["--wait"]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
ENTRYPOINT ["/dockerstartup/kasm_default_profile.sh" "/dockerstartup/vnc_startup.sh" "/dockerstartup/kasm_startup.sh"]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
USER 1000                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
RUN DISTRO=debian START_XFCE4=1 START_PULSEAUDIO=1 BG_IMG=bg_jammy.png EXTRA_SH=noop.sh DISTRO=debian LANG=en_US.UTF-8 LANGUAGE=en_US:en LC_ALL=en_US.UTF-8 /bin/sh -c touch $STARTUPDIR/wm.log   && touch $STARTUPDIR/window_manager_startup.log   && touch $STARTUPDIR/vnc_startup.log   && touch $STARTUPDIR/no_vnc_startup.log   && chown -R root:root $STARTUPDIR   && find $STARTUPDIR -type d -exec chmod 755   && find $STARTUPDIR -type f -exec chmod 644   && find $STARTUPDIR -type f -iname "*.sh" -exec chmod 755   && find $STARTUPDIR -type f -iname "*.py" -exec chmod 755   && find $STARTUPDIR -type f -iname "*.rb" -exec chmod 755   && find $STARTUPDIR -type f -iname "*.pl" -exec chmod 755   && find $STARTUPDIR -type f -iname "*.log" -exec chmod 666   && chmod 755 $STARTUPDIR/upload_server/kasm_upload_server   && chmod 755 $STARTUPDIR/audio_input/kasm_audio_input_server   && chmod 755 $STARTUPDIR/generate_container_user   && chmod +x $STARTUPDIR/jsmpeg/kasm_audio_out-linux   && rm -rf $STARTUPDIR/install   && mkdir -p $STARTUPDIR/kasmrx/Downloads   && chown 1000:1000 $STARTUPDIR/kasmrx/Downloads   && chown -R root:root /usr/local/bin   && chown 1000:root /var/run/pulse   && rm -Rf /home/kasm-default-profile/.launchpadlib # buildkit  
RUN DISTRO=debian START_XFCE4=1 START_PULSEAUDIO=1 BG_IMG=bg_jammy.png EXTRA_SH=noop.sh DISTRO=debian LANG=en_US.UTF-8 LANGUAGE=en_US:en LC_ALL=en_US.UTF-8 /bin/sh -c mkdir -p $HOME && chown -R 1000:0 $HOME # buildkit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
WORKDIR /home/kasm-user                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
ENV HOME=/home/kasm-user                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
RUN DISTRO=debian START_XFCE4=1 START_PULSEAUDIO=1 BG_IMG=bg_jammy.png EXTRA_SH=noop.sh DISTRO=debian LANG=en_US.UTF-8 LANGUAGE=en_US:en LC_ALL=en_US.UTF-8 /bin/sh -c (groupadd -g 1000 kasm-user   && useradd -M -u 1000 -g 1000 kasm-user   && usermod -a -G kasm-user kasm-user) ; exit 0 # buildkit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
RUN DISTRO=debian START_XFCE4=1 START_PULSEAUDIO=1 BG_IMG=bg_jammy.png EXTRA_SH=noop.sh DISTRO=debian LANG=en_US.UTF-8 LANGUAGE=en_US:en LC_ALL=en_US.UTF-8 /bin/sh -c bash $INST_SCRIPTS/virtualgl/install_virtualgl.sh && rm -rf $INST_SCRIPTS/virtualgl/ # buildkit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
COPY ./src/ubuntu/install/virtualgl /dockerstartup/install/virtualgl/ # buildkit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
RUN DISTRO=debian START_XFCE4=1 START_PULSEAUDIO=1 BG_IMG=bg_jammy.png EXTRA_SH=noop.sh DISTRO=debian LANG=en_US.UTF-8 LANGUAGE=en_US:en LC_ALL=en_US.UTF-8 /bin/sh -c bash $INST_SCRIPTS/extra/$EXTRA_SH && rm -rf $INST_SCRIPTS/extra/ # buildkit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
COPY ./src/ubuntu/install/extra /dockerstartup/install/extra/ # buildkit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
RUN DISTRO=debian START_XFCE4=1 START_PULSEAUDIO=1 BG_IMG=bg_jammy.png EXTRA_SH=noop.sh DISTRO=debian LANG=en_US.UTF-8 LANGUAGE=en_US:en LC_ALL=en_US.UTF-8 /bin/sh -c bash $STARTUPDIR/set_user_permission.sh $STARTUPDIR $HOME &&   echo 'source $STARTUPDIR/generate_container_user' >> $HOME/.bashrc # buildkit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
ADD ./src/common/startup_scripts /dockerstartup # buildkit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
COPY ./src/common/scripts/kasm_hook_scripts /dockerstartup # buildkit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
RUN DISTRO=debian START_XFCE4=1 START_PULSEAUDIO=1 BG_IMG=bg_jammy.png EXTRA_SH=noop.sh DISTRO=debian LANG=en_US.UTF-8 LANGUAGE=en_US:en LC_ALL=en_US.UTF-8 /bin/sh -c chmod +x /etc/squid/start_squid.sh && chmod 4755 /etc/squid/start_squid.sh # buildkit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
RUN DISTRO=debian START_XFCE4=1 START_PULSEAUDIO=1 BG_IMG=bg_jammy.png EXTRA_SH=noop.sh DISTRO=debian LANG=en_US.UTF-8 LANGUAGE=en_US:en LC_ALL=en_US.UTF-8 /bin/sh -c chmod +x /etc/squid/kasm_squid_adapter # buildkit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
RUN DISTRO=debian START_XFCE4=1 START_PULSEAUDIO=1 BG_IMG=bg_jammy.png EXTRA_SH=noop.sh DISTRO=debian LANG=en_US.UTF-8 LANGUAGE=en_US:en LC_ALL=en_US.UTF-8 /bin/sh -c rm -rf $INST_SCRIPTS/resources/ # buildkit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
RUN DISTRO=debian START_XFCE4=1 START_PULSEAUDIO=1 BG_IMG=bg_jammy.png EXTRA_SH=noop.sh DISTRO=debian LANG=en_US.UTF-8 LANGUAGE=en_US:en LC_ALL=en_US.UTF-8 /bin/sh -c chown proxy:proxy /usr/local/squid/share/errors/en/ERR_ACCESS_DENIED # buildkit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
COPY ./src/ubuntu/install/squid/resources/error_message/access_denied.html /usr/local/squid/share/errors/en/ERR_ACCESS_DENIED # buildkit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
RUN DISTRO=debian START_XFCE4=1 START_PULSEAUDIO=1 BG_IMG=bg_jammy.png EXTRA_SH=noop.sh DISTRO=debian LANG=en_US.UTF-8 LANGUAGE=en_US:en LC_ALL=en_US.UTF-8 /bin/sh -c chown proxy:proxy /usr/local/squid/share/icons/SN.png # buildkit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
COPY ./src/ubuntu/install/squid/resources/SN.png /usr/local/squid/share/icons/SN.png # buildkit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
COPY ./src/ubuntu/install/squid/resources/start_squid.sh /etc/squid/start_squid.sh # buildkit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
COPY ./src/ubuntu/install/squid/resources/*.conf /etc/squid/ # buildkit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
RUN DISTRO=debian START_XFCE4=1 START_PULSEAUDIO=1 BG_IMG=bg_jammy.png EXTRA_SH=noop.sh DISTRO=debian LANG=en_US.UTF-8 LANGUAGE=en_US:en LC_ALL=en_US.UTF-8 /bin/sh -c bash $INST_SCRIPTS/squid_install/install_squid.sh && rm -rf $INST_SCRIPTS/squid_install/ # buildkit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
COPY ./src/ubuntu/install/squid/install/ /dockerstartup/install/squid_install/ # buildkit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
RUN DISTRO=debian START_XFCE4=1 START_PULSEAUDIO=1 BG_IMG=bg_jammy.png EXTRA_SH=noop.sh DISTRO=debian LANG=en_US.UTF-8 LANGUAGE=en_US:en LC_ALL=en_US.UTF-8 /bin/sh -c bash $INST_SCRIPTS/cursors/install_cursors.sh && rm -rf $INST_SCRIPTS/cursors/ # buildkit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
COPY ./src/ubuntu/install/cursors /dockerstartup/install/cursors/ # buildkit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
RUN DISTRO=debian START_XFCE4=1 START_PULSEAUDIO=1 BG_IMG=bg_jammy.png EXTRA_SH=noop.sh DISTRO=debian LANG=en_US.UTF-8 LANGUAGE=en_US:en LC_ALL=en_US.UTF-8 /bin/sh -c bash $INST_SCRIPTS/audio_input/install_audio_input.sh && rm -rf $INST_SCRIPTS/audio_input/ # buildkit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
COPY ./src/ubuntu/install/audio_input /dockerstartup/install/audio_input/ # buildkit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
RUN DISTRO=debian START_XFCE4=1 START_PULSEAUDIO=1 BG_IMG=bg_jammy.png EXTRA_SH=noop.sh DISTRO=debian LANG=en_US.UTF-8 LANGUAGE=en_US:en LC_ALL=en_US.UTF-8 /bin/sh -c bash $INST_SCRIPTS/audio/install_audio.sh && rm -rf $INST_SCRIPTS/audio/ # buildkit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
COPY ./src/ubuntu/install/audio /dockerstartup/install/audio/ # buildkit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
RUN DISTRO=debian START_XFCE4=1 START_PULSEAUDIO=1 BG_IMG=bg_jammy.png EXTRA_SH=noop.sh DISTRO=debian LANG=en_US.UTF-8 LANGUAGE=en_US:en LC_ALL=en_US.UTF-8 /bin/sh -c bash $INST_SCRIPTS/kasm_upload_server/install_kasm_upload_server.sh && rm -rf $INST_SCRIPTS/kasm_upload_server/ # buildkit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
COPY ./src/ubuntu/install/kasm_upload_server /dockerstartup/install/kasm_upload_server/ # buildkit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
RUN DISTRO=debian START_XFCE4=1 START_PULSEAUDIO=1 BG_IMG=bg_jammy.png EXTRA_SH=noop.sh DISTRO=debian LANG=en_US.UTF-8 LANGUAGE=en_US:en LC_ALL=en_US.UTF-8 /bin/sh -c bash $INST_SCRIPTS/kasm_vnc/install_kasm_vnc.sh && rm -rf $INST_SCRIPTS/kasm_vnc/ # buildkit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
COPY ./src/ubuntu/install/kasm_vnc /dockerstartup/install/kasm_vnc/ # buildkit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
ADD /src/common/resources/images/icon_kasm.png /usr/share/extra/icons/icon_kasm.png # buildkit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
ADD /src/common/resources/images/icon_ubuntu.png /usr/share/extra/icons/icon_default.png # buildkit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
ADD /src/common/resources/images/icon_ubuntu.png /usr/share/extra/icons/icon_ubuntu.png # buildkit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
ADD /src/common/resources/images/bg_jammy.png /usr/share/extra/backgrounds/bg_default.png # buildkit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
ADD /src/common/resources/images/bg_kasm.png /usr/share/extra/backgrounds/bg_kasm.png # buildkit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
RUN DISTRO=debian START_XFCE4=1 START_PULSEAUDIO=1 BG_IMG=bg_jammy.png EXTRA_SH=noop.sh DISTRO=debian LANG=en_US.UTF-8 LANGUAGE=en_US:en LC_ALL=en_US.UTF-8 /bin/sh -c mkdir -p /usr/share/extra/icons/ # buildkit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
RUN DISTRO=debian START_XFCE4=1 START_PULSEAUDIO=1 BG_IMG=bg_jammy.png EXTRA_SH=noop.sh DISTRO=debian LANG=en_US.UTF-8 LANGUAGE=en_US:en LC_ALL=en_US.UTF-8 /bin/sh -c mkdir -p /usr/share/extra/backgrounds/ # buildkit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
ADD ./src/ubuntu/xfce/.config/ /home/kasm-default-profile/.config/ # buildkit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
RUN DISTRO=debian START_XFCE4=1 START_PULSEAUDIO=1 BG_IMG=bg_jammy.png EXTRA_SH=noop.sh DISTRO=debian LANG=en_US.UTF-8 LANGUAGE=en_US:en LC_ALL=en_US.UTF-8 /bin/sh -c bash $INST_SCRIPTS/xfce/install_xfce_ui.sh && rm -rf $INST_SCRIPTS/xfce/ # buildkit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
COPY ./src/ubuntu/install/xfce /dockerstartup/install/xfce/ # buildkit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
RUN DISTRO=debian START_XFCE4=1 START_PULSEAUDIO=1 BG_IMG=bg_jammy.png EXTRA_SH=noop.sh DISTRO=debian LANG=en_US.UTF-8 LANGUAGE=en_US:en LC_ALL=en_US.UTF-8 /bin/sh -c bash $INST_SCRIPTS/fonts/install_custom_fonts.sh && rm -rf $INST_SCRIPTS/fonts/ # buildkit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
COPY ./src/ubuntu/install/fonts /dockerstartup/install/fonts/ # buildkit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
COPY ./src/ubuntu/install/maximize_script /dockerstartup/ # buildkit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
RUN DISTRO=debian START_XFCE4=1 START_PULSEAUDIO=1 BG_IMG=bg_jammy.png EXTRA_SH=noop.sh DISTRO=debian LANG=en_US.UTF-8 LANGUAGE=en_US:en LC_ALL=en_US.UTF-8 /bin/sh -c bash $INST_SCRIPTS/tools/install_tools.sh && rm -rf $INST_SCRIPTS/tools/ # buildkit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
COPY ./src/ubuntu/install/tools /dockerstartup/install/tools/ # buildkit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
COPY src/ubuntu/install/nvidia/10_nvidia.json /usr/share/glvnd/egl_vendor.d/10_nvidia.json # buildkit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
ENV NVIDIA_DRIVER_CAPABILITIES=graphics,compat32,utility                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
ENV LD_LIBRARY_PATH=/usr/lib/x86_64-linux-gnu:/usr/lib/i386-linux-gnu:/opt/libjpeg-turbo/lib64/:/usr/local/lib/:/usr/local/nvidia/lib:/usr/local/nvidia/lib64                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
RUN DISTRO=debian START_XFCE4=1 START_PULSEAUDIO=1 BG_IMG=bg_jammy.png EXTRA_SH=noop.sh DISTRO=debian LANG=en_US.UTF-8 LANGUAGE=en_US:en LC_ALL=en_US.UTF-8 /bin/sh -c echo "/usr/local/nvidia/lib" >> /etc/ld.so.conf.d/nvidia.conf &&   echo "/usr/local/nvidia/lib64" >> /etc/ld.so.conf.d/nvidia.conf # buildkit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
RUN DISTRO=debian START_XFCE4=1 START_PULSEAUDIO=1 BG_IMG=bg_jammy.png EXTRA_SH=noop.sh DISTRO=debian LANG=en_US.UTF-8 LANGUAGE=en_US:en LC_ALL=en_US.UTF-8 /bin/sh -c mkdir -p $HOME/Desktop # buildkit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
WORKDIR /home/kasm-default-profile                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
EXPOSE map[4901/tcp:{} 5901/tcp:{} 6901/tcp:{}]   


ENV DISPLAY=:1 VNC_PORT=5901 NO_VNC_PORT=6901 VNC_PORT=5901 AUDIO_PORT=4901 VNC_RESOLUTION=1280x720 MAX_FRAME_RATE=24 VNCOPTIONS=-PreferBandwidth -DynamicQualityMin=4 -DynamicQualityMax=7 -DLP_ClipDelay=0 HOME=/home/kasm-default-profile TERM=xterm STARTUPDIR=/dockerstartup INST_SCRIPTS=/dockerstartup/install KASM_VNC_PATH=/usr/share/kasmvnc DEBIAN_FRONTEND=noninteractive VNC_COL_DEPTH=24 VNC_RESOLUTION=1280x1024 VNC_PW=vncpassword VNC_VIEW_ONLY_PW=vncviewonlypassword LD_LIBRARY_PATH=/opt/libjpeg-turbo/lib64/:/usr/local/lib/ OMP_WAIT_POLICY=PASSIVE SHELL=/bin/bash START_XFCE4=1 START_PULSEAUDIO=1 LANG=en_US.UTF-8 LANGUAGE=en_US:en LC_ALL=en_US.UTF-8 KASMVNC_AUTO_RECOVER=true PULSE_RUNTIME_PATH=/var/run/pulse                                                                                                                                                                                                                                                                                                                     
ARG LC_ALL=en_US.UTF-8                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
ARG LANGUAGE=en_US:en                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
ARG LANG=en_US.UTF-8                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
ARG DISTRO=debian                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
ARG EXTRA_SH=noop.sh                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
ARG BG_IMG=bg_kasm.png                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
ARG START_PULSEAUDIO=0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
ARG START_XFCE4=0    

LABEL com.kasmweb.gpu_acceleration_egl=nvidia                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
LABEL com.kasmweb.image=true                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
LABEL org.opencontainers.image.authors=Kasm Tech="raspsatcombot@gmail.com"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
ARG DISTRO=debian                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
# /bin/bash -c #(nop) CMD ["bash"]  



# sudo docker build -t satcomx00/core-debian-latest .
# sudo docker push satcomx00/core-debian-latest:latest
